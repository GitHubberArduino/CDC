(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-505e8abd","chunk-2d0e5d28"],{"06cb":function(e,t,a){"use strict";a.r(t);var i=a("e192"),o=a.n(i),r=a("a9f7"),l=a("95b8"),s=a("ebb0"),n=a.n(s),h={MAP:{GET_BOUNDS:"bounds",FILTER_NON_THEMATIC:"filter_non_thematic"}},c=a("c4be"),d=a.n(c);const m=new n.a(new d.a),filterNonThematicCodes=e=>m.postMessage({type:h.MAP.FILTER_NON_THEMATIC,data:e});var p={map:{filterNonThematicCodes:filterNonThematicCodes}},u=a("a26f"),y=a("d27a"),L=a("3921"),E=a("6f4b"),v=a("b8ce"),S=a.n(v),f=a("0644"),g=a.n(f),I=a("13ea"),C=a.n(I),T=a("0f32"),O=a.n(T);function createLayerStyle(e,t,a,i){const o=g()(e);return o.id=a?t+a+i:t,o.source=t,o}class SmartMap_SmartMap{constructor(e,t={controls:!0}){this.map=new o.a.Map(e),this.map.thematicData={},this.map.selectedGeos=[],this.map.geoLevel="",this.prevLayers=[],this.highlightedGeoID=void 0,t.controls&&this.addControls({source:t.source}),this.mouseDownFnRef=null,this.touchStartFnRef=null,l["default"].registerErrorHandler(this.map)}setGeoLevel(e){this.map.geoLevel=e}addControls({source:e}){this.map.addControl(new o.a.ScaleControl({maxWidth:120,unit:"imperial"}),"bottom-right"),this.map.addControl(new o.a.NavigationControl({showCompass:!1}),"top-right"),e&&this.map.addControl(this.sourceControl=new o.a.AttributionControl({customAttribution:""+e}),"bottom-right")}updateSourceControl({source:e}){this.sourceControl&&(this.map.removeControl(this.sourceControl),delete this.sourceControl),e&&this.map.addControl(this.sourceControl=new o.a.AttributionControl({customAttribution:""+e}),"bottom-right")}displaySelectedGeos(e){if(this.map.selectedGeos=e,this.map.getLayer(r["a"].LAYER_TYPES.DYNAMIC)){const t=e.length>0?["in","GEOID"].concat(e):["==","GEOID",""];this.map.setFilter(r["a"].LAYER_TYPES.DYNAMIC,t),this.map.setPaintProperty(r["a"].LAYER_TYPES.DYNAMIC,"fill-opacity",r["a"].DEFAULT_FILL_OPACITY),this.map.setPaintProperty(r["a"].LAYER_TYPES.DYNAMIC,"fill-color",r["a"].FILL_COLOR.SELECTION,{validate:!1})}}multiselect(e,t){e?(this.mouseDownFnRef=l["default"].registerBoxSelectEvent(this.map,t),this.touchStartFnRef=l["default"].registerBoxSelectTouch(this.map,t)):(l["default"].unregisterBoxSelect(this.map,this.mouseDownFnRef),l["default"].unregisterBoxSelectTouch(this.map,this.touchStartFnRef))}removeLabel(e,t){for(let a=0;a<t;a++)this.map.removeLayer(`${e}_label${a}`)}removeLayer(e,t){for(let a=0;a<t;a++){this.map.removeLayer(`${e}${r["a"].LAYER_TYPES.GEOMETRY}${a}`);const t=`${e}${r["a"].LAYER_TYPES.IDENTIFY}${a}`;this.map.getLayer(t)&&this.map.removeLayer(t)}}removePrevLayers(){this.prevLayers.forEach(e=>{this.map.getLayer(e)&&this.map.removeLayer(e)}),this.prevLayers=[]}addLayerStack(e,t,a,i={removePrevLayers:!0,setToCurrentLayer:!0,zoomToLayer:!0,geometry:!0,dynamic:!0,hover:!0,label:!0,currentLayerGeometry:!0}){if(this.map.thematicLayerVtpk=void 0,this.map.thematicLineOutlineColor=void 0,this.map.thematicFillOutlineColor=void 0,this.map.thematicLineOutlineWidths=void 0,!C()(e)&&t)try{const o=e.get(t);i.setToCurrentLayer&&(this.map.columnLabel=o.columnLabel),i.removePrevLayers&&this.prevLayers.length>0&&this.removePrevLayers();let l=[];if(l=S()(o.themRefLayers).reverse(),i.dynamic&&this.addDynamicFills(o),i.geometry){const s=!0,n=e.get(t).name;for(let h=0;h<l.length;h++){let c={};for(const a of e.values())if(a.name===l[h]){if(a.name!==n){c=a;break}a.vtpk===t&&(c=a)}if(0!==Object.entries(c).length){if(h!==l.length-1||i.currentLayerGeometry){const e=o.summaryLevel===c.summaryLevel&&!c.displayOnlyLayer;this.addGeometries(c,a,{dropFillColor:s,changeOutline:e&&!0===i.dynamic&&a===L["b"].THEMATIC&&r["a"].LEVELS_WITH_SET_THEMATIC_WIDTH.includes(c.summaryLevel),isThematicLevel:e})}i.label&&this.addLabels(c)}else console.warn(`layer ${l[h]} does not exist`)}}if(i.hover&&this.addHoverHighlight(o),i.zoomToLayer){const e=this.map.getZoom();e<o.minZoomLevelDraw?this.map.zoomTo(o.minZoomLevelDraw):e>o.layerStyles[0].maxzoom&&this.map.zoomTo(o.layerStyles[0].maxzoom)}}catch(o){throw new Error("map failed to add layers:\n      "+o)}else console.warn("You need to provide available layers first")}addGeometries(e,t,a={dropFillColor:!1,changeOutline:!1,isThematicLevel:!1}){this.addTileSource(e.vtpk,e.tileSource);for(let i=0;i<e.layerStyles.length;i++){const o=createLayerStyle(e.layerStyles[i],e.vtpk,r["a"].LAYER_TYPES.GEOMETRY,i);if("fill"===o.type)a.dropFillColor&&o.paint&&o.paint["fill-color"]&&(o.paint["fill-color"]=r["a"].FILL_COLOR.TRANSPARENT);else if("line"===o.type){const t=createLayerStyle(e.layerStyles[i],e.vtpk,r["a"].LAYER_TYPES.IDENTIFY,i);t.type="fill",t.layout={},t.paint={"fill-color":r["a"].FILL_COLOR.TRANSPARENT},this.addLayerByStyle(t)}t===L["b"].THEMATIC&&a.isThematicLevel&&(this.map.thematicLayerVtpk=o.id,"line"===o.type?(this.map.thematicLineOutlineColor=o.paint["line-color"],a.changeOutline&&(this.map.thematicLineOutlineWidths=o.paint["line-width"])):"fill"===o.type&&(this.map.thematicFillOutlineColor=o.paint["fill-outline-color"])),this.addLayerByStyle(o)}}outlineGeography(e,t,a){this.addTileSource(e.vtpk,e.tileSource);const i=createLayerStyle(e.layerStyles[0],e.vtpk);i.id=r["a"].LAYER_TYPES.OUTLINE,i.type="line",i.layout={},i.paint={"line-width":r["a"].LINE_WIDTH,"line-color":a?r["a"].LINE_COLOR_ACCENT:r["a"].LINE_COLOR},i.filter=["==","GEOID",t],this.addLayerByStyle(i)}outlineUSGeography(e,t){const a={id:r["a"].LAYER_TYPES.OUTLINE,type:"line",source:"esri","source-layer":"State",paint:{"line-width":r["a"].LINE_WIDTH,"line-color":t?r["a"].LINE_COLOR_ACCENT:r["a"].LINE_COLOR}};a.filter=["==","GEOID",e],this.addLayerByStyle(a)}addDynamicFills(e){this.addTileSource(e.vtpk,e.tileSource);const t=createLayerStyle(e.layerStyles[0],e.vtpk);t.id=r["a"].LAYER_TYPES.DYNAMIC,t.type="fill",t.layout={},t.paint={"fill-opacity":r["a"].DEFAULT_FILL_OPACITY,"fill-color":r["a"].FILL_COLOR.TRANSPARENT},t.filter=["==","GEOID",""];const a=createLayerStyle(e.layerStyles[0],e.vtpk);a.id=r["a"].LAYER_TYPES.DYNAMIC_INVISIBLE,a.type="fill",a.layout={},a.paint={"fill-color":r["a"].FILL_COLOR.TRANSPARENT},this.addLayerByStyle(t),this.addLayerByStyle(a)}addDynamicUSFills(){const e={id:r["a"].LAYER_TYPES.DYNAMIC,type:"fill",source:"esri","source-layer":"State",paint:{"fill-opacity":r["a"].DEFAULT_FILL_OPACITY,"fill-color":r["a"].FILL_COLOR.TRANSPARENT,"fill-outline-color":"#828282"}},t={id:r["a"].LAYER_TYPES.DYNAMIC_INVISIBLE,type:"fill",source:"esri","source-layer":"State",paint:{"fill-color":r["a"].FILL_COLOR.TRANSPARENT}};this.addLayerByStyle(e),this.addLayerByStyle(t),this.addHoverHighlight()}addHoverHighlight(e){let t;t=e?createLayerStyle(e.layerStyles[0],e.vtpk):{source:"esri","source-layer":"State"},t.id=r["a"].LAYER_TYPES.HOVER,t.type="line",t.layout={},t.paint={"line-color":r["a"].HOVER_COLOR,"line-width":r["a"].HOVER_OUTLINE_WIDTH},t.filter=["==","GEOID",""],this.addLayerByStyle(t),void 0===this.highlightedGeoID&&this.addHoverEvents()}addHoverEvents(){this.highlightedGeoID="";const e=O()(e=>{var t;const a=null===(t=this.map.queryRenderedFeatures(e.point,{layers:[r["a"].LAYER_TYPES.DYNAMIC_INVISIBLE]})[0])||void 0===t?void 0:t.properties;a&&a.GEOID!==this.highlightedGeoID&&(this.highlightedGeoID=a.GEOID,this.map.setFilter(r["a"].LAYER_TYPES.HOVER,["==","GEOID",this.highlightedGeoID]))},100);this.map.on("mouseover",()=>{this.map.on("mousemove",r["a"].LAYER_TYPES.DYNAMIC_INVISIBLE,t=>{e(t)})}),this.map.on("mouseout",()=>{this.map.off("mousemove",r["a"].LAYER_TYPES.DYNAMIC_INVISIBLE,t=>{e(t)}),setTimeout(()=>{this.clearHoverHighlight()},100)})}clearHoverHighlight(){this.highlightedGeoID="",this.map.setFilter(r["a"].LAYER_TYPES.HOVER,["==","GEOID",this.highlightedGeoID])}addLabels(e){this.addTileSource(e.vtpk,e.tileSource),e.labelStyles.forEach((t,a)=>{const i=createLayerStyle(t,e.vtpk,r["a"].LAYER_TYPES.LABEL,a);this.addLayerByStyle(i)})}addTileSource(e,t){if(!this.map.getSource(e)){const a="https://gis.data.census.gov"+t+"/tile/{z}/{y}/{x}.pbf";this.map.addSource(e,{type:"vector",tiles:[a]})}}addLayerByStyle(e){void 0===this.map.getLayer(e.id)&&(this.map.addLayer(e),this.prevLayers.push(e.id))}isNoData(e){return!!(null===e||""===e||e<0||isNaN(e))}async prepareThematicDataForDisplay(e,t,a,i){var o;if(!this.map.getLayer(r["a"].LAYER_TYPES.DYNAMIC))throw new Error("no dynamic thematic layer exists");const l={};let s=[],n=0;const h={},c={},d=[];e.forEach(e=>{if(e.geoCodeOrID=e.geoCode,e.annotation)l[e.geoCodeOrID]=e.annotation;else if(!this.isNoData(e.value)){const t=e.value.toString().split(".")[1];t&&t.length>n&&(n=t.length),c[e.geoCodeOrID]=Object(y["a"])(e.value,a),h[e.geoCodeOrID]=e.value,d.push(e.geoCodeOrID)}}),null!==(o=t)&&void 0!==o&&o.length?s=await p.map.filterNonThematicCodes({codes:t,validCodes:d}):t=d,this.map.selectedGeos=t,this.map.thematicData=c;var m=t.length>0?["in","GEOID"].concat(t):["==","GEOID",""];return this.map.setFilter(r["a"].LAYER_TYPES.DYNAMIC,m),0===t.length?this.map.thematicLayerVtpk&&(this.map.thematicLineOutlineColor?(this.map.setPaintProperty(this.map.thematicLayerVtpk,"line-color",this.map.thematicLineOutlineColor),this.map.thematicLineOutlineWidths&&this.map.setPaintProperty(this.map.thematicLayerVtpk,"line-width",this.map.thematicLineOutlineWidths)):this.map.thematicFillOutlineColor&&this.map.setPaintProperty(this.map.thematicLayerVtpk,"fill-outline-color",this.map.thematicFillOutlineColor)):this.map.setPaintProperty(r["a"].LAYER_TYPES.DYNAMIC,"fill-opacity",i),{thematicData:h,precision:n,noDataCodes:s}}calculateAndRenderStops(e,t,a,i){let o=null===t||void 0===t?void 0:t.length;(!o||o<1)&&(o=1);const l=Object(u["b"])({color:a,breaks:o}),s={};for(const h in e){let a=r["a"].FILL_COLOR.NO_DATA;for(let i=0;i<t.length;i++)if(e[h]>=t[i].low&&e[h]<=t[i].high){a=l[i],t[i].count++;break}s[h]=a}if(i.forEach(e=>{s[e]=r["a"].FILL_COLOR.NO_DATA}),Object.keys(s).length>0){const e="GEOID",t=r["a"].LAYER_TYPES.DYNAMIC;this.map.setPaintProperty(t,"fill-color",["get",["get",e],["literal",s]],{validate:!0});try{if(this.map.thematicLayerVtpk){const t=Object.keys(s);if(this.map.thematicLineOutlineColor){if(this.map.setPaintProperty(this.map.thematicLayerVtpk,"line-color",["match",["get",e],t,r["a"].OUTLINE_COLOR,this.map.thematicLineOutlineColor]),this.map.thematicLineOutlineWidths){const a=["interpolate",["linear"],["zoom"]];r["a"].ZOOM_WIDTHS.forEach((i,o)=>{a.push(i[0]);let r=i[1];this.map.thematicLineOutlineWidths.stops&&this.map.thematicLineOutlineWidths.stops[o]&&(r=this.map.thematicLineOutlineWidths.stops[o][1]),a.push(["match",["get",e],t,i[1],r])}),this.map.setPaintProperty(this.map.thematicLayerVtpk,"line-width",a)}}else this.map.thematicFillOutlineColor&&this.map.setPaintProperty(this.map.thematicLayerVtpk,"fill-outline-color",["match",["get",e],t,r["a"].OUTLINE_COLOR,this.map.thematicFillOutlineColor])}}catch(n){console.warn("Error occured while attempting to modify thematic outline color/width")}}return{ranges:t,noDataCount:i.length,colors:l}}isUSMap(){var e,t;const a=this.map.getStyle();return!!a&&((null===a||void 0===a||null===(e=a.sprite)||void 0===e?void 0:e.includes(E["a"].GRAY))||(null===a||void 0===a||null===(t=a.sprite)||void 0===t?void 0:t.includes(E["a"].DETAILED)))}}t["default"]={init:(e,t)=>(e.preserveDrawingBuffer=!0,new SmartMap_SmartMap(e,t))}},"95b8":function(e,t,a){"use strict";a.r(t),function(e){var i=a("e192"),o=a.n(i),r=a("a9f7");a("79e7"),t["default"]={registerErrorHandler(e){e.on("error",e=>{console.warn(e)})},registerBoxSelectEvent(e,t){const a=e.getCanvasContainer();let i,l,s;a.style.cursor="crosshair";const mousePos=e=>{const t=a.getBoundingClientRect();return new o.a.Point(e.clientX-t.left-a.clientLeft,e.clientY-t.top-a.clientTop)},mouseDown=e=>{document.addEventListener("mousemove",onMouseMove),document.addEventListener("mouseup",onMouseUp),i=mousePos(e)},onMouseMove=e=>{l=mousePos(e),s||(s=document.createElement("div"),s.classList.add("boxdraw"),a.appendChild(s));const t=Math.min(i.x,l.x),o=Math.max(i.x,l.x),r=Math.min(i.y,l.y),n=Math.max(i.y,l.y),h="translate("+t+"px,"+r+"px)";s.style.transform=h,s.style.WebkitTransform=h,s.style.width=o-t+"px",s.style.height=n-r+"px"},onMouseUp=e=>{finish([i,mousePos(e)])},finish=a=>{document.removeEventListener("mousemove",onMouseMove),document.removeEventListener("mouseup",onMouseUp),s&&(s.parentNode.removeChild(s),s=null);const i=Math.abs(a[0].x-a[1].x)+Math.abs(a[0].y-a[1].y);if(i<=3)return;const o=e.queryRenderedFeatures(a,{layers:[r["a"].LAYER_TYPES.DYNAMIC_INVISIBLE]});if(o&&o.length>0){const a=[];o.forEach(t=>{t.properties.GEOID&&a.push(e.geoLevel+"US"+t.properties.GEOID)}),t(a)}};return e.dragPan.disable(),a.addEventListener("mousedown",mouseDown,!0),mouseDown},unregisterBoxSelect(e,t){const a=e.getCanvasContainer();a.removeEventListener("mousedown",t,!0),e.dragPan.enable(),a.style.cursor=""},registerBoxSelectTouch(e,t){const a=e.getCanvasContainer();let i,l,s;const touchPos=e=>{const t=e.changedTouches[0],i=a.getBoundingClientRect();return new o.a.Point(t.clientX-i.left-a.clientLeft,t.clientY-i.top-a.clientTop)},onTouchStart=e=>{e.preventDefault(),document.addEventListener("touchmove",onTouchMove),document.addEventListener("touchend",onTouchEnd),i=touchPos(e)},onTouchMove=e=>{l=touchPos(e),s||(s=document.createElement("div"),s.classList.add("boxdraw"),a.appendChild(s));const t=Math.min(i.x,l.x),o=Math.max(i.x,l.x),r=Math.min(i.y,l.y),n=Math.max(i.y,l.y),h="translate("+t+"px,"+r+"px)";s.style.transform=h,s.style.WebkitTransform=h,s.style.width=o-t+"px",s.style.height=n-r+"px"},onTouchEnd=a=>{document.removeEventListener("touchmove",onTouchMove),document.removeEventListener("touchend",onTouchEnd),s&&(s.parentNode.removeChild(s),s=null);const o=[i,touchPos(a)],l=e.queryRenderedFeatures(o,{layers:[r["a"].LAYER_TYPES.DYNAMIC_INVISIBLE]});if(l&&l.length>0){const a=[];l.forEach(t=>{t.properties.GEOID&&a.push(e.geoLevel+"US"+t.properties.GEOID)}),t(a)}};return e.dragPan.disable(),a.addEventListener("touchstart",onTouchStart,!0),onTouchStart},unregisterBoxSelectTouch(e,t){const a=e.getCanvasContainer();a.removeEventListener("touchstart",t,!0),e.dragPan.enable()},onMapRenderComplete(t,a){if(t.loaded())return e.nextTick(a);t.once("render",()=>this.onMapRenderComplete(t,a))}}}.call(this,a("4362"))},c4be:function(e,t,a){e.exports=function(){return new Worker(a.p+"8b1c88f7fececb5d6a3f.worker.js")}}}]);
//# sourceMappingURL=chunk-505e8abd.d85fda4e.js.map